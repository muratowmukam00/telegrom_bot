#!/bin/bash

echo "ðŸš€ Ð˜Ð½Ð¸Ñ†Ð¸Ð°Ð»Ð¸Ð·Ð°Ñ†Ð¸Ñ MEXC Signal Bot..."

# ÐŸÑ€Ð¾Ð²ÐµÑ€ÑÐµÐ¼ Python Ð²ÐµÑ€ÑÐ¸ÑŽ
python_version=$(python3 --version 2>&1 | awk '{print $2}')
echo "âœ… Python Ð²ÐµÑ€ÑÐ¸Ñ: $python_version"

# Ð¡Ð¾Ð·Ð´Ð°Ñ‘Ð¼ Ð²Ð¸Ñ€Ñ‚ÑƒÐ°Ð»ÑŒÐ½Ð¾Ðµ Ð¾ÐºÑ€ÑƒÐ¶ÐµÐ½Ð¸Ðµ ÐµÑÐ»Ð¸ ÐµÐ³Ð¾ Ð½ÐµÑ‚
if [ ! -d "venv" ]; then
    echo "ðŸ“¦ Ð¡Ð¾Ð·Ð´Ð°Ð½Ð¸Ðµ Ð²Ð¸Ñ€Ñ‚ÑƒÐ°Ð»ÑŒÐ½Ð¾Ð³Ð¾ Ð¾ÐºÑ€ÑƒÐ¶ÐµÐ½Ð¸Ñ..."
    python3 -m venv venv
    source venv/bin/activate
    pip install --upgrade pip
fi

# ÐÐºÑ‚Ð¸Ð²Ð¸Ñ€ÑƒÐµÐ¼ Ð¾ÐºÑ€ÑƒÐ¶ÐµÐ½Ð¸Ðµ
source venv/bin/activate

# Ð£ÑÑ‚Ð°Ð½Ð°Ð²Ð»Ð¸Ð²Ð°ÐµÐ¼ Ð·Ð°Ð²Ð¸ÑÐ¸Ð¼Ð¾ÑÑ‚Ð¸
echo "ðŸ“¥ Ð£ÑÑ‚Ð°Ð½Ð¾Ð²ÐºÐ° Ð·Ð°Ð²Ð¸ÑÐ¸Ð¼Ð¾ÑÑ‚ÐµÐ¹..."
if command -v poetry &> /dev/null; then
    poetry install
else
    pip install -r requirements.txt
fi

# Ð¡Ð¾Ð·Ð´Ð°Ñ‘Ð¼ Ð½ÐµÐ¾Ð±Ñ…Ð¾Ð´Ð¸Ð¼Ñ‹Ðµ Ð¿Ð°Ð¿ÐºÐ¸
mkdir -p logs
mkdir -p screenshots

# Ð¡Ð¾Ð·Ð´Ð°Ñ‘Ð¼ .env ÐµÑÐ»Ð¸ ÐµÐ³Ð¾ Ð½ÐµÑ‚
if [ ! -f ".env" ]; then
    echo "âš ï¸  Ð¡Ð¾Ð·Ð´Ð°Ð½Ð¸Ðµ .env Ñ„Ð°Ð¹Ð»Ð°..."
    cp .env.example .env 2>/dev/null || cat > .env << 'ENVEOF'
# Telegram Bot
TELEGRAM_BOT_TOKEN=YOUR_BOT_TOKEN_HERE
TELEGRAM_CHAT_ID=YOUR_CHAT_ID_HERE

# MEXC API (Ð¿ÑƒÐ±Ð»Ð¸Ñ‡Ð½Ñ‹Ð¹)
MEXC_BASE_URL=https://contract.mexc.com

# Bot Settings
CHECK_INTERVAL=60
PRICE_CHANGE_THRESHOLD=8

# RSI Settings
RSI_PERIOD=14
RSI_OVERBOUGHT=70
RSI_OVERSOLD=30

# Logging
LOG_LEVEL=INFO
ENVEOF
    echo "âš ï¸  Ð’ÐÐ–ÐÐž: ÐžÑ‚Ñ€ÐµÐ´Ð°ÐºÑ‚Ð¸Ñ€ÑƒÐ¹Ñ‚Ðµ .env Ð¸ Ð´Ð¾Ð±Ð°Ð²ÑŒÑ‚Ðµ Ð²Ð°ÑˆÐ¸ Ñ‚Ð¾ÐºÐµÐ½Ñ‹!"
    echo "   nano .env"
fi

echo "âœ… Ð˜Ð½Ð¸Ñ†Ð¸Ð°Ð»Ð¸Ð·Ð°Ñ†Ð¸Ñ Ð·Ð°Ð²ÐµÑ€ÑˆÐµÐ½Ð°!"
echo ""
echo "ðŸ“‹ Ð¡Ð»ÐµÐ´ÑƒÑŽÑ‰Ð¸Ðµ ÑˆÐ°Ð³Ð¸:"
echo "1. ÐžÑ‚Ñ€ÐµÐ´Ð°ÐºÑ‚Ð¸Ñ€ÑƒÐ¹Ñ‚Ðµ .env: nano .env"
echo "2. Ð”Ð¾Ð±Ð°Ð²ÑŒÑ‚Ðµ TELEGRAM_BOT_TOKEN Ð¸ TELEGRAM_CHAT_ID"
echo "3. Ð—Ð°Ð¿ÑƒÑÑ‚Ð¸Ñ‚Ðµ Ð±Ð¾Ñ‚Ð°: python main.py"
echo ""
